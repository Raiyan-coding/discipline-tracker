<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mission Tracker v3</title>
<style>
body {
  margin:0;
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background: #121212;
  color: #f0f0f0;
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 20px;
}
.calendar-container {
  width: 420px;
  background: #1e1e1e;
  border-radius: 16px;
  box-shadow: 0 8px 20px rgba(0,0,0,0.6);
  overflow: hidden;
  margin-bottom: 30px;
}
.month-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 15px 20px;
  background: #282828;
  font-weight: bold;
  font-size: 18px;
  color: #fff;
}
.month-header button {
  background: #444;
  border: none;
  color: #fff;
  font-size: 18px;
  padding: 5px 12px;
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.2s ease;
}
.month-header button:hover { background: #ff4d4d; }
.weekdays {
  display: grid;
  grid-template-columns: repeat(7,1fr);
  text-align: center;
  font-weight: bold;
  padding: 10px 0;
  background: #222;
}
.days {
  display: grid;
  grid-template-columns: repeat(7,1fr);
  gap: 6px;
  padding: 10px;
}
.day {
  background: #2a2a2a;
  padding: 18px 0;
  border-radius: 8px;
  text-align: center;
  cursor: default;
  position: relative;
  transition: transform 0.2s, background 0.3s;
}
.day:hover { transform: scale(1.05); }
.day.today { border: 2px solid #4CAF50; font-weight: bold; cursor:pointer; }
.day.guardian { background: #3a3a3a; }
.day.completed { background: #4CAF50; color: #fff; font-weight: bold; animation: markAnim 0.3s ease-out forwards; }
.day.failed { background: #ff4d4d; color: #fff; font-weight: bold; }
.day.nodata { background: #ffb74d; color: #000; font-weight: bold; } 
.day.historical { background: #8B4513; color: #fff; font-weight: bold; } 
.day.locked { background: #555; color: #ccc; font-weight: bold; cursor: not-allowed; }

@keyframes markAnim { 0% {transform:scale(1);} 50%{transform:scale(1.3);} 100%{transform:scale(1);} }

.chart-container {
  width: 250px;
  height: 250px;
  position: relative;
  margin-top: 20px;
}
canvas { background: #1e1e1e; border-radius: 50%; cursor:pointer; }

.chart-labels {
  position: absolute;
  top: 50%; left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
  color: #fff;
}
.chart-labels div { margin: 5px 0; font-size: 14px; cursor:default; }

.analysis-panel {
  margin-top: 20px;
  background: #1e1e1e;
  padding: 15px 20px;
  border-radius: 12px;
  width: 420px;
}
.analysis-panel h3 { margin-top:0; text-align:center; color:#fff;}
.analysis-panel div { margin: 5px 0; font-size: 14px; color:#ccc;}
</style>
</head>
<body>

<div class="calendar-container">
  <div class="month-header">
    <button id="prev">&lt;</button>
    <div id="month-name"></div>
    <button id="next">&gt;</button>
  </div>
  <div class="weekdays">
    <div>Sun</div><div>Mon</div><div>Tue</div><div>Wed</div>
    <div>Thu</div><div>Fri</div><div>Sat</div>
  </div>
  <div class="days" id="days"></div>
</div>

<div class="chart-container">
  <canvas id="missionChart" width="250" height="250"></canvas>
  <div class="chart-labels">
    <div>Completed: <span id="c-label">0</span></div>
    <div>Failed: <span id="f-label">0</span></div>
    <div>No Data: <span id="n-label">0</span></div>
    <div>Left: <span id="l-label">0</span></div>
  </div>
</div>

<div class="analysis-panel">
  <h3>Mission Analysis</h3>
  <div>Total Mission Days: <span id="total-days">0</span></div>
  <div>Completed Days: <span id="completed-days">0</span></div>
  <div>Failed Days: <span id="failed-days">0</span></div>
  <div>No Data Days: <span id="historical-days">0</span></div>
  <div>Remaining Days: <span id="remaining-days">0</span></div>
  <div>Completion Rate: <span id="completion-rate">0</span>%</div>
  <div>Failure Rate: <span id="failure-rate">0</span>%</div>
</div>

<script>
const daysContainer = document.getElementById('days');
const monthName = document.getElementById('month-name');
const prevBtn = document.getElementById('prev');
const nextBtn = document.getElementById('next');
const canvas = document.getElementById('missionChart');
const ctx = canvas.getContext('2d');

const cLabel = document.getElementById('c-label');
const fLabel = document.getElementById('f-label');
const nLabel = document.getElementById('n-label');
const lLabel = document.getElementById('l-label');

const totalDaysEl = document.getElementById('total-days');
const completedEl = document.getElementById('completed-days');
const failedEl = document.getElementById('failed-days');
const historicalEl = document.getElementById('historical-days');
const remainingEl = document.getElementById('remaining-days');
const completionRateEl = document.getElementById('completion-rate');
const failureRateEl = document.getElementById('failure-rate');

const today = new Date();
let viewMonth = today.getMonth();
let viewYear = today.getFullYear();
const months = ["January","February","March","April","May","June","July","August","September","October","November","December"];

// Mission timeline
const missionStart = new Date(today.getFullYear(),7,1); // Aug 1
const missionEnd = new Date(today.getFullYear(),9,31);  // Oct 31
const historicalEnd = new Date(today.getFullYear(),7,14); // Aug 14

// Locked revision mission (Nov 1â€“22)
const revisionMissionStart = new Date(today.getFullYear(),10,1);
const revisionMissionEnd = new Date(today.getFullYear(),10,22);

let chartData = [];

function drawChart(completed, failed, nodata, historical, left){
  chartData = [
    {value:completed, color:'#4CAF50', label:'Completed'},
    {value:failed, color:'#ff4d4d', label:'Failed'},
    {value:nodata, color:'#ffb74d', label:'No Data'},
    {value:historical, color:'#8B4513', label:'Historical'},
    {value:left, color:'#3a3a3a', label:'Left'}
  ];

  const total = completed+failed+nodata+historical+left;
  let startAngle= -0.5*Math.PI;
  ctx.clearRect(0,0,250,250);

  chartData.forEach(seg=>{
    if(seg.value===0) return;
    const angle = (seg.value/total)*2*Math.PI;
    ctx.beginPath();
    ctx.moveTo(125,125);
    ctx.fillStyle = seg.color;
    ctx.arc(125,125,120,startAngle,startAngle+angle);
    ctx.fill();
    startAngle+=angle;
  });

  // Inner circle
  ctx.beginPath();
  ctx.fillStyle='#1e1e1e';
  ctx.arc(125,125,80,0,2*Math.PI);
  ctx.fill();

  // Update center labels
  cLabel.textContent = `${completed} (${((completed/total)*100).toFixed(1)}%)`;
  fLabel.textContent = `${failed} (${((failed/total)*100).toFixed(1)}%)`;
  nLabel.textContent = `${historical} (${((historical/total)*100).toFixed(1)}%)`;
  lLabel.textContent = `${left} (${((left/total)*100).toFixed(1)}%)`;
}

// ================= Calendar & logic =================
function pad(n){ return n<10?'0'+n:n; }

function updateAnalysis(completed, failed, nodata, historical, left){
  const totalDays = completed + failed + nodata + historical + left;
  totalDaysEl.textContent = totalDays;
  completedEl.textContent = completed + ` (${((completed/totalDays)*100).toFixed(1)}%)`;
  failedEl.textContent = failed + ` (${((failed/totalDays)*100).toFixed(1)}%)`;
  historicalEl.textContent = historical + ` (${((historical/totalDays)*100).toFixed(1)}%)`;
  remainingEl.textContent = left + ` (${((left/totalDays)*100).toFixed(1)}%)`;
  completionRateEl.textContent = ((completed/totalDays)*100).toFixed(1);
  failureRateEl.textContent = ((failed/totalDays)*100).toFixed(1);
}

function updateChart(){
  let completed=0, failed=0, historical=0, left=0;
  let cur = new Date(missionStart.getTime());
  while(cur <= missionEnd){
    const key = `${cur.getFullYear()}-${cur.getMonth()+1}-${cur.getDate()}`;
    const dayDate = new Date(cur.getFullYear(), cur.getMonth(), cur.getDate());

    if(dayDate <= historicalEnd) historical++;
    else if(dayDate.toDateString() === today.toDateString()){
      if(localStorage.getItem(key) === 'true') completed++;
      else left++;
    }
    else if(dayDate < today){
      if(localStorage.getItem(key) === 'true') completed++;
      else if(localStorage.getItem(key) === 'failed') failed++;
      else failed++;
    } else left++;
    cur.setDate(cur.getDate()+1);
  }

  drawChart(completed, failed, 0, historical, left);
  updateAnalysis(completed, failed, 0, historical, left);
}

function loadCalendar(month, year){
  daysContainer.innerHTML='';
  monthName.textContent = `${months[month]} ${year}`;
  const firstDay = new Date(year, month,1).getDay();
  const lastDate = new Date(year, month+1,0).getDate();

  for(let i=0;i<firstDay;i++){ daysContainer.appendChild(document.createElement('div')); }

  for(let date=1; date<=lastDate; date++){
    const dayDiv = document.createElement('div');
    dayDiv.classList.add('day');
    dayDiv.textContent = date;
    const key = `${year}-${month+1}-${date}`;
    const dayDate = new Date(year, month, date);

    if(dayDate >= missionStart && dayDate <= missionEnd) dayDiv.classList.add('guardian');
    if(dayDate <= historicalEnd) dayDiv.classList.add('historical');
    if(dayDate < today && dayDate > historicalEnd){
      if(localStorage.getItem(key) === 'true') dayDiv.classList.add('completed');
      else if(localStorage.getItem(key) === 'failed') dayDiv.classList.add('failed');
      else dayDiv.classList.add('failed');
    }

    if(dayDate.toDateString() === today.toDateString()){
      dayDiv.classList.add('today');
      if(localStorage.getItem(key) === 'true') dayDiv.classList.add('completed');
      else dayDiv.addEventListener('click', ()=>{
        const confirmClick = confirm("Are you sure you have completed all tasks for today?");
        if(confirmClick){
          dayDiv.classList.remove('nodata');
          dayDiv.classList.add('completed');
          localStorage.setItem(key,'true');
          updateChart();
        }
      });
    }

    if(dayDate > today && dayDate <= missionEnd) dayDiv.classList.add('guardian');

    if(dayDate >= revisionMissionStart && dayDate <= revisionMissionEnd){
      dayDiv.classList.add('locked');
      dayDiv.title="Locked: Will unlock after current mission";
    }

    daysContainer.appendChild(dayDiv);
  }
  updateChart();
}

prevBtn.addEventListener('click', ()=>{
  if(viewMonth===0){ viewMonth=11; viewYear--; } else viewMonth--;
  loadCalendar(viewMonth, viewYear);
});
nextBtn.addEventListener('click', ()=>{
  if(viewMonth===11){ viewMonth=0; viewYear++; } else viewMonth++;
  loadCalendar(viewMonth, viewYear);
});

loadCalendar(viewMonth, viewYear);

// Auto-mark past days failed after 24h
setInterval(()=>{
  const todayKey = `${today.getFullYear()}-${today.getMonth()+1}-${today.getDate()}`;
  const endOfDay = new Date(today.getFullYear(), today.getMonth(), today.getDate(),23,59,59);
  if(!localStorage.getItem(todayKey) && new Date()>=endOfDay){
    localStorage.setItem(todayKey,'failed');
    loadCalendar(viewMonth, viewYear);
  }
},60000);





</script>
</body>
</html>
